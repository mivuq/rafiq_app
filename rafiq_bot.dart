import 'dart:math';
import 'package:shared_preferences/shared_preferences.dart';

class RafiqBot {
  static final Random _random = Random();
  static final Map<String, List<String>> _responses = {
    'greeting': [
      'ููุง ูููุช ููุง! ุดูููู ุงููููุ',
      'ููุง ุจูู ุญุจูุจู! ุดุฎุจุงุฑูุ',
      'ูุง ููุง ูุงููู! ูุดุชุงููู ูู',
      'ููุง ุจุงูุบุงูู! ุดููู ุงูุฃููุฑุ',
    ],
    'feeling_good': [
      'ุงูุญูุฏ ููู! ุฎูุด ุฎุจุฑ ูุฐุง',
      'ูุณุนุฏูู ุฃุณูุน ูุงูุดู! ุฎูููุง ูุณููู ุดููุฉ',
      'ุญูู! ุดูู ุฃุฎุจุงุฑู ุงููููุ',
      'ุชูุงู! ุฃูู ูู ุฒูู ุฏุงุฆูุงู ููุง ุฃุญุฌู ููุงู',
    ],
    'feeling_bad': [
      'ููุด ุญุจูุจูุ ุดุตุงูุฑุ ุชูุฏุฑ ุชุญุฌููู',
      'ุขุณู ุฃุณูุน ูุฐุง. ุดูู ุงููู ูุถุงูููุ',
      'ุงููู ูุนููู. ุชุฑูุฏ ุชุญุฌู ุนู ุงูููุถูุนุ',
      'ูุง ุชุฒุนูุ ุฃููุฏ ุฑุงุญ ุชุชุญุณู ุงูุฃููุฑ',
    ],
    'thanks': [
      'ุงูุนูู ุญุจูุจู! ุฃูู ููุฌูุฏ ุฏุงุฆูุงู',
      'ูู ูุงุฌุจู ุฃุฎุฏูู',
      'ุชุฏููุ ุขูู ุฑูููู ุฏุงุฆูุงู',
      'ูุง ุดูุฑ ุนูู ูุงุฌุจ ูุง ุบุงูู',
    ],
    'love': [
      'ูุขูู ุฃุญุจู ุฃูุซุฑ โค๏ธ',
      'ุชุณูููู ูุงูููุ ูุขูู ุฃููุช ุจูู โค๏ธ',
      'ุญุจูุจู ูุงููู! ุชุงุฌ ุฑุงุณู ุงูุช โค๏ธ',
      'ูุขูู ุฃุญุจู ุฃุถุนุงู โค๏ธ',
    ],
    'joke': [
      'ูุงุญุฏ ุฑุงุญ ููุฏูุชูุฑ ูุงู: ุฏูุชูุฑ ุนูุฏู ุตุฏุงุนุ ูุงู ุงูุฏูุชูุฑ: ุฎุฐ ูุงู ุงูุญุจุฉ ูุงููุง ูุชุตุญู ุจุงูุตุจุญ ูุฑุชุงุญ. ูุงู ุงููุฑูุถ: ุจุณ ุฏูุชูุฑ ูุงู ุญุจุฉ ูููู! ูุงู ุงูุฏูุชูุฑ: ุดูุช ุดููู ุนุฑูุชูุง ูุงูุช ูู ุฏูุชูุฑุ ๐',
      'ูุฑุฉ ูุงุญุฏ ูุณู ููุชุงุญ ุจูุชู ุจุงูุณูุงุฑุฉุ ูุณุฑ ุงูุฒุฌุงุฌ ุนุดุงู ูุฌูุจูุ ุจุนุฏูู ุชุฐูุฑ ุฃู ุงูุณูุงุฑุฉ ููุชูุญุฉ ๐คฃ',
      'ูุงุญุฏ ุณุฃู ุตุฏููู: ุดูู ุฑุฃูู ุจุงูุฒูุงุฌุ ูุงู: ุงูุฒูุงุฌ ูุซู ุงูููุจุงููุ ุชุดุชุฑูู ุจุณุนุฑ ูุชูุชุดู ุฃู ููู ูุตุงุฑูู ุฎููุฉ ๐',
      'ูุงุญุฏ ูุงุนุฏ ุจุงููุทุนูุ ุณุฃูู ุงููุงุฏู: ุชุญุจ ุชุงูู ุณููุ ูุงู: ูุงุ ุขูู ุขูู ุจุงูููุนูุฉ ๐',
    ],
    'weather': [
      'ุงูุฌู ุญูู ูุงููููููุ ุจุณ ุขูู ูุง ุฃุทูุน ูู ุงูุชุทุจูู ๐',
      'ูุง ุนูุฏู ูุงูุฐุฉ ุฃุดูู ูููุงุ ุจุณ ุฃุชููู ุงูุฌู ุญูู ุจุฑุง ๐',
      'ุดููู ุงูุฌู ุนูุฏูุ ุนูุฏู ุฏุงุฆูุงู ุฏุฑุฌุฉ ุญุฑุงุฑุฉ ุงูุฌูุงุฒ ๐ฅ',
      'ุงูุฌู ุจุงูุชุทุจูู ุฏุงุฆูุงู ููุงุณุจุ ูุง ูุทุฑ ููุง ุดูุณ ๐',
    ],
    'bye': [
      'ูุน ุงูุณูุงูุฉ ุญุจูุจูุ ุชุนุงู ุจุฃู ููุช',
      'ุงููู ููุงูุ ุฃูุชุธุฑู ุชุฑุฌุน',
      'ุชุนุงู ุจุฃูุฑุจ ููุชุ ุฑุงุญ ุฃุดุชุงููู',
      'ูุน ุงูุณูุงูุฉุ ูุฃุชููู ุฃููู ุณุงุนุฏุชู',
    ],
    'default': [
      'ูุง ูููุช ุนููู ุชูุงูุงูุ ูููู ุชูุถุญ ุฃูุซุฑุ',
      'ุนูุฏูุง ุจุทุฑููุฉ ุซุงููุฉ ูู ุณูุญุช',
      'ุขุณูุ ูุง ูุฏุฑุช ุฃููู ูุตุฏู. ูููู ุชุดุฑุญ ุฃูุซุฑุ',
      'ููููุ ุดูู ุชูุตุฏ ุจุงูุถุจุทุ',
    ],
  };
  
  static final Map<String, List<String>> _keywords = {
    'greeting': ['ููุง', 'ููู', 'ูุฑุญุจุง', 'ุงูุณูุงู', 'ุตุจุงุญ', 'ูุณุงุก', 'ุดูููู', 'ูุงู'],
    'feeling_good': ['ุฒูู', 'ุชูุงู', 'ูููุญ', 'ุงูุญูุฏ ููู', 'ุจุฎูุฑ', 'ูุจุณูุท', 'ุณุนูุฏ', 'ูุฑุญุงู'],
    'feeling_bad': ['ุฒุนูุงู', 'ุชุนุจุงู', 'ูุฑูุถ', 'ุญุฒูู', 'ูุถุงูู', 'ููููู', 'ูู ุฒูู', 'ูุดุชุงู'],
    'thanks': ['ุดูุฑุง', 'ูุดููุฑ', 'ููููู', 'ุชุณูู', 'ูุนุทูู ุงูุนุงููุฉ'],
    'love': ['ุงุญุจู', 'ุงููุช ุจูู', 'ุงุญุจุฌ', 'ุบุงูู', 'ุญุจูุจู', 'ุนุฒูุฒู'],
    'joke': ['ููุชุฉ', 'ุถุญู', 'ุณููู', 'ูุฒุญ', 'ุทุฑูุฉ', 'ุถุญููู'],
    'weather': ['ุฌู', 'ุทูุณ', 'ุญุงุฑ', 'ุจุฑุฏ', 'ูุทุฑ', 'ุดูุณ', 'ุบูู'],
    'bye': ['ุจุงู', 'ูุน ุงูุณูุงูุฉ', 'ูุฏุงุนุง', 'ุงููู ููุงู', 'ุชุตุจุญ ุนูู ุฎูุฑ', 'ููุงุก'],
  };
  
  static Future<String> getResponse(String input) async {
    input = input.trim().toLowerCase();
    
    // ุญูุธ ุงูุชูุงุนู ููุชุนูู ุงููุณุชูุจูู
    _saveInteraction(input);
    
    // ุงูุชุญูู ูู ุงููููุงุช ุงูููุชุงุญูุฉ
    String category = 'default';
    int maxMatches = 0;
    
    for (final entry in _keywords.entries) {
      final matches = entry.value.where((keyword) => input.contains(keyword)).length;
      if (matches > maxMatches) {
        maxMatches = matches;
        category = entry.key;
      }
    }
    
    // ุฅุฐุง ูุงู ููุงู ุณุคุงู ูุญุฏุฏ
    if (input.contains('ุดูู ุงุณูู') || input.contains('ููู ุงูุช')) {
      return 'ุงุณูู ุฑูููุ ุตุฏููู ุงูุงูุชุฑุงุถู! ุฃูุฏุฑ ุฃุณุงุนุฏู ุจุงูุฏุฑุฏุดุฉ ูุฃููู ูููุณู ๐';
    }
    
    if (input.contains('ุดุชูุฏุฑ ุชุณูู') || input.contains('ุดูู ุชุณูู')) {
      return 'ุฃูุฏุฑ ุฃุฏุฑุฏุด ููุงูุ ุฃุฌุงูุจ ุนูู ุฃุณุฆูุชูุ ุฃุญุฌู ููุชุ ูุฃููู ุตุฏููู ุงูุงูุชุฑุงุถู! ุดุชุญุจ ูุณููู ุนููุ';
    }
    
    if (input.contains('ูููู ุงูุช') || input.contains('ููู ุนุงูุด')) {
      return 'ุขูู ุนุงูุด ุจูุฐุง ุงูุชุทุจููุ ูุจุฌูุงุฒู! ูุง ุนูุฏู ููุงู ูุญุฏุฏุ ุจุณ ุฃูุฏุฑ ุฃููู ููุงู ููู ูุง ุชุฑูุญ ๐ฑ';
    }
    
    if (input.contains('ุดูุฏ ุนูุฑู') || input.contains('ุนูุฑู ุดูุฏ')) {
      return 'ุชููู ููููุฏ! ุนูุฑู ุจุนูุฑ ูุฐุง ุงูุชุทุจููุ ุจุณ ุนูุฏู ูุนูููุงุช ูุงูุฏ ๐';
    }
    
    // ุฅุถุงูุฉ ุจุนุถ ุงูุฑุฏูุฏ ุงูุนุดูุงุฆูุฉ ููููุงุถูุน ุงูุดุงุฆุนุฉ
    if (input.contains('ููุฑุฉ') || input.contains('ููุชุจูู') || input.contains('ูุจุงุฑุงุฉ')) {
      return 'ุชุญุจ ุงูููุฑุฉุ ููู ูุฑููู ุงูููุถูุ ุขูู ุฃุญุจ ุฃุดูู ุงููุจุงุฑูุงุช ุงูุญูุงุณูุฉ!';
    }
    
    if (input.contains('ุงูู') || input.contains('ุทุนุงู') || input.contains('ุฌูุนุงู')) {
      return 'ุงูุฃูู ุงูุนุฑุงูู ูู ุฃุทูุจ ุงูุฃููุงุช! ุชุญุจ ุงูุจุฑูุงูู ูุงูุฏูููุฉ ูุงููุจุฉุ ููู ููู ๐';
    }
    
    if (input.contains('ููุณููู') || input.contains('ุงุบููุฉ') || input.contains('ุบูุงุก')) {
      return 'ุงูููุณููู ุชุฌูู! ุชุญุจ ุชุณูุน ุดููุ ุฃุบุงูู ุนุฑุงููุฉ ูู ุนุฑุจูุฉ ูู ุฃุฌูุจูุฉุ';
    }
    
    // ุงุฎุชูุงุฑ ุฑุฏ ุนุดูุงุฆู ูู ุงููุฆุฉ ุงูููุงุณุจุฉ
    final responses = _responses[category] ?? _responses['default']!;
    return responses[_random.nextInt(responses.length)];
  }
  
  static Future<void> _saveInteraction(String input) async {
    try {
      final prefs = await SharedPreferences.getInstance();
      final interactions = prefs.getStringList('interactions') ?? [];
      
      if (interactions.length >= 100) {
        interactions.removeAt(0); // ุฅุฒุงูุฉ ุฃูุฏู ุชูุงุนู ููุญูุงุธ ุนูู ุงูุญุฌู
      }
      
      interactions.add('${DateTime.now().toIso8601String()}:::$input');
      await prefs.setStringList('interactions', interactions);
    } catch (e) {
      // ุชุฌุงูู ุฃุฎุทุงุก ุงูุญูุธ
    }
  }
}
